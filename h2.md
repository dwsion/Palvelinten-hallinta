# Laitteisto

## x) Lue ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva. Ei siis vaadita pitkää eikä essee-muotoista tiivistelmää.)
   - Karvinen 2021: Two Machine Virtual Network With Debian 11 Bullseye and Vagrant (Huomaa: nykyinen Debian stable on 12-Bookworm, Vagrantissa "debian/bookworm64". Vanhentunutta 11-bullseye:ta ei enää käytetä)
   - Karvinen 2018: Salt Quickstart – Salt Stack Master and Slave on Ubuntu Linux (Huomaa: Nykyisin ennen Saltin asentamista on asennettava ensin varasto [package repository], ohje h1 vinkeissä)
   - Karvinen 2014: Hello Salt Infra-as-Code (Huomaa: kannattaa laittaa jokainen moduli omaan kansioonsa toisin kuin artikkelissani. Hyvä: "/srv/salt/hello/init.sls" eli moduli "hello" siististi omana kansionaan. Huono: "/srv/salt/hups.sls" eli sls-tiedostot ja kaikki niihin liittyvät muotit hujan hajan saltin pääkansiossa)
   - Karvinen 2023: Salt Vagrant - automatically provision one master and two slaves, vain kohdat
            Infra as Code - Your wishes as a text file
            top.sls - What Slave Runs What States
   - Salt contributors: Salt overview, kohdat
            Rules of YAML
            YAML simple structure
            Lists and dictionaries - YAML block structures




## a) Hello Vagrant! Osoita jollain komennolla, että Vagrant on asennettu

Tarkistin mikä versio Vagrantista koneella oli seuraavalla komennolla:

      vagrant --version

ja vastauksena tuli seuraavaa, joten totesin vagrantin olevan asennettuna koneelle

![image](https://github.com/user-attachments/assets/9a944fe0-fdb1-4c9c-aae0-d9b052ea4111)

## b) Linux Vagrant. Tee Vagrantilla uusi Linux-virtuaalikone

Aloitin luomalla ohjeiden mukaisesti uuden kansion.

![image](https://github.com/user-attachments/assets/04559df6-44ac-4703-a7cd-b2cfecdafaf9)

Komennolla

      vagrant init

loi Vagrantin konffitiedoston ja sain ilmoituksen, että nyt voin alkaa luomaan koneita vagrant up-komennolla. Avasin vielä Vagrantfile-tiedoston, jotta näin sinne jotain tulleen.

![image](https://github.com/user-attachments/assets/76904aa3-33b4-405f-a8a0-c78d1ac0a777)

![image](https://github.com/user-attachments/assets/06436302-000a-4a44-8961-e9daa6a7fdbe)

Seuraavaksi kokeilin luoda uuden koneen, mutta sain virheilmoituksen, jonka jälkeen kokeilin kopioida suoraan Tero Karvisen materiaaleista asennustiedoston, päivitin sen Vagrantfileen ja kokeilin uudelleen. Edelleen sain virheen.

![image](https://github.com/user-attachments/assets/460c4f66-d5a4-49de-ad8c-5eaf3edf0d6a)

Virheen googlauksen jälkeen löysin komennon, jolla tuo libvirt ongelma pitäisi poistua.

![image](https://github.com/user-attachments/assets/f42dcbfa-ce59-4da7-a071-02cace3af786)

Asennus lähti käyntiin kivasti ja olikin sen jälkeen toiveikas olo, kun kokeilin vagrant up-komentoa uudelleen.

![image](https://github.com/user-attachments/assets/23fe9cf7-c1b9-4072-812f-414787c794e9)

Nyt jotain selvästi alkoi tapahtumaan ja ehkäpä siis onnistuin luomaan Vagrantilla kolme virtuaalikonetta? :)

![image](https://github.com/user-attachments/assets/4e1768a0-1412-47ae-8f21-577dfd1ea029)


Kohtasin ongelmia loppujen lopuksi, kun yritin ajaa vagrantia virtualboxilla luodulla virtuaalikoneella, joten siirryin testaamaan tätä windowsin puolelle.

![image](https://github.com/user-attachments/assets/1bd136c3-7269-4e9c-a8e0-5dd36e8dd0fd)


Seuraavaksi loin uudelleen kansion vagrant projektille nimeltä twohost Teron ohjeiden mukaisesti( Tero Karvinen, 2021 ). Siirryin sisälle kansioon ja loin Vagrantfilen edelleen ohjeiden mukaisesti, päivitin kuitenkin konffitiedostosta debian linux-verison uudempaan( bullseye-->bookworm64).

![image](https://github.com/user-attachments/assets/3bf47ddd-7305-486c-bcdf-30523781d2fa)

not![image](https://github.com/user-attachments/assets/b7e6a7d4-bc55-4369-9b30-d8dd23517d62)

Sitten ajoin komennon vagrant init pyydettäessä ja sitten vagrant up, mutta sain virheilmoituksen, että

tiedoston lataaminen ei onnistunut. Kävin katsomassa konffitiedostoa ja huomasin, että vagrant init oli luonut uuden tiedoston. Joten poistin luomani Vagrant.txt- tiedoston ja muutin Vagrantfile tiedoston sisällön uudeksi.

![image](https://github.com/user-attachments/assets/5a2f7f70-d7c8-46d4-82b9-3e1421451c8f)

Nyt kokeilin uudelleen vagrant up-komentoa.

![image](https://github.com/user-attachments/assets/886a3d14-a352-4f04-8bbc-6136f57f5a5b)

ja koneet asentuivatkin sieltä nyt nätisti: 

![image](https://github.com/user-attachments/assets/a63a3119-aabc-42ee-bb83-dd43ec482a6e)

Avasin koneen nyt komennolla: vagrant ssh t001 ja se toimi hienosti. Tsekkasin myös pwd-komennolla kansion rakenteen Linux-koneella.

![image](https://github.com/user-attachments/assets/27610ac5-dcfa-4d51-a9be-d04aa1104ea2)

Kokeilin myös toisen koneen toimivuuttaa/asentumista samalla tavoin.

![image](https://github.com/user-attachments/assets/c700a261-f6c4-45c4-89ac-82604423e8be)

Koneet näkyivät myös virtuaaliboxissa:

![image](https://github.com/user-attachments/assets/58733a90-5223-4661-b518-3a4a6163e50a)


## c) Kaksin kaunihimpi. Tee kahden Linux-tietokoneen verkko Vagrantilla. Osoita, että koneet voivat pingata toisiaan.


Tämä tulikin tehtyä jo edellisessä kohdassa, joten kirjauduin sisään molempiin koneisiin vuorotellen ja pingasin sieltä toista konetta.

Ensin kirjauduin koneelle t001 komennolla:

      vagrant ssh t001

ja pingasin konetta t002: 

      ping -c 1 192.168.88.102. 

![image](https://github.com/user-attachments/assets/9716f75f-e40d-486e-9fe4-c18c60cb6499)
    
      
Sitten kirjauduin ulos t001:ltä exit-komennolla ja sisään t002:seen komennolla:

      vagrant ssh t002

jossa pingasin vuorostaan t001- konetta: 

      ping -c 1 192.168.88.101

Kokeilin myös tältä koneelta pingata Googlen nimipalvelinta:

![image](https://github.com/user-attachments/assets/f7950dcc-743e-4b2d-a580-5bb73bb60882)

Koneet löysivät toisensa pingillä, joten ne ovat olemassa ja samassa verkossa.


## d) Herra-orja verkossa. Demonstroi Salt herra-orja arkkitehtuurin toimintaa kahden Linux-koneen verkossa, jonka teit Vagrantilla. Asenna toiselle koneelle salt-master, toiselle salt-minion. Laita orjan /etc/salt/minion -tiedostoon masterin osoite. Hyväksy avain ja osoita, että herra voi komentaa orjakonetta.

Päätin tässä kohtaa käyttää ohjeessa( Tero Karvinen, 2023) olevaa valmista konffitiedostoa, jossa luodaan uudet koneet ja niihin asennetaan suoraan salt-minion ja salt-master.

![image](https://github.com/user-attachments/assets/863b588f-bfac-4c36-a6c2-0cb0809e9569)

![image](https://github.com/user-attachments/assets/94a43d95-019c-4854-aba3-0a4251495415)




## e) Hei infrakoodi! Kokeile paikallisesti (esim 'sudo salt-call --local') infraa koodina. Kirjota sls-tiedosto, joka tekee esimerkkitiedoston /tmp/ -kansioon.

## f) Aja esimerkki sls-tiedostosi verkon yli orjalla.

## g) Tee sls-tiedosto, joka käyttää vähintään kahta eri tilafunktiota näistä: package, file, service, user. Tarkista eri ohjelmalla, että lopputulos on oikea. Osoita useammalla ajolla, että sls-tiedostosi on idempotentti.

## h) Top file. Automatisoi vähintään kahden tilan / modulin ajaminen. Esim. komento 'sudo salt "*" state.apply' tai 'sudo salt-call --local state.apply' ajaa modulit "hello" ja "apache".

## i) Vapaaehtoinen, haastavahko tässä vaiheessa: Asenna ja konfiguroi Apache. Sen tulee näyttää palvelimen etusivulla weppisivua. Weppisivun tulee olla muokattavissa käyttäjän oikeuksin, ilman sudoa.



### Lähteet

- Vagrant Install. https://developer.hashicorp.com/vagrant/install
- Tero Karvinen, 2021. https://terokarvinen.com/2021/two-machine-virtual-network-with-debian-11-bullseye-and-vagrant/
- Tero Karvinen, 2023  https://terokarvinen.com/2023/salt-vagrant/#infra-as-code---your-wishes-as-a-text-file
